# DB Locking
- Optimistic Lock/Pessimistic Lock에 대해 설명해 주세요.
- 물리적인 Lock을 건다면, 만약 이를 수행중인 요청에 문제가 생겨 비정상 종료되면 Lock이 절대 해제되지 않는 문제가 생길 수도 있을 것 같습니다. DB는 이를 위한 해결책이 있나요? 없다면, 우리가 이 문제를 해결할 수 없을까요?

### DB Locking은 여러 유저가 사용하는 환경에서 데이터의 일관성을 유지하기 위해 필요

#### Locking 레벨 
- Database Level: 데이터 베이스 전체를 한 유저만 사용
- Table Level: 전체 테이블을 읽거나 쓰는 것을 막을 수 있음
- Page/Block Level: 테이블의 특정 부분을 제한 
- Row Level
- Column Level: row의 특정 부분 제한

#### Lock Type:
- Shared Lock: 다양한 트랜젝션을 데이터를 읽을 수 있으나 쓰는 것은 한 명이 한 번 씩만
- Exclusive Lock: 오직 한 유저만 쓰거나 읽을 수 있음


# Pessimistic Locking
- 충돌이 일어난다고 가정하여 
- 데이터 읽거나 변형 전에 락 걸어버림 
- 데이터 경합이 많은 환경에서 데이터 업데이트가 확실히 보장된 환경에서 써야 한다. 

# Optimistic Locking
- Pessimistic보다 관대하다
- 충돌이 거의 일어나지 않을 것이라고 가정
- 데이터 버전으로 변경할 수 있음
- 커밋할 때만 충돌 체크한다
- 데이터 경합보다 많이 읽는 환경에서 쓰기 좋음

## 선택지
1. 데이터 경합이 많은 환경 -> Pessimistic Locking
2. 읽기 많고, 업데이터 덜한 환경 -> Optimistic Locking


#  물리적인 Lock을 건다면, 만약 이를 수행중인 요청에 문제가 생겨 비정상 종료되면 Lock이 절대 해제되지 않는 문제가 생길 수도 있을 것 같습니다. DB는 이를 위한 해결책이 있나요? 없다면, 우리가 이 문제를 해결할 수 없을까요?

1. 자동 해제: RDBMS에서 제공하는 Timeout으로 Lock 유지 되는 시간 조정되어 자동으로 Lock 해제
2. Deadlock Detection: 데드락이 발생할 경우 알고리즘에 의해서 덜 중요한 Lock 부터 없어짐
3. 2-Phase Locking: Lock을 얻고 해제하는 과정. 모든 락이 얻어야 수정 가능 
4. Lock Manager: 중앙에서 관리하는 Lock Manager 존재
5. Transaction Logging: 모든 데이터 변경 사항 저장하여서 종료되더라도 Log를 통해서 복구하여 Lock 해제
